# Maintainer: Florian Schweiger <mpkmpoza@duck.com>
upstream_name=actions-for-nautilus
pkgname="$upstream_name-git"
pkgver=v1.6.1
pkgrel=1
pkgdesc='Nautilus extension to add arbitrary actions to the file selection context menu'
arch=('x86_64')
license=('Apache')
depends=('nautilus' 'python-nautilus' 'python-gobject' 'procps-ng' 'jquery')
makedepends=('git' 'sed')
optdepends=('baobab' 'gtkhash' 'xclip' 'zenity')
provides=()
conflicts=('filemanager-actions')
backup=("~/.local/share/actions-for-nautilus/config.json")
options=()
install=${pkgname}.install
changelog=
url="https://github.com/elppans/${upstream_name}"
source=("git+${url}.git#branch=main")
noextract=()
sha256sums=('SKIP')

prepare() {
  sed -Ei 's#(^.*LOC=)\$\(.+ALLOC\)#\1/usr/share#' "$srcdir/$upstream_name/Makefile"
}
# pkgver() {
# 	cd "$upstream_name"
# 	git describe --tags | tr - _
# }
package() {
  cd "${srcdir}/${upstream_name}"
  make GLOBALLOC="$pkgdir/usr/share" install_global
}
cat > "${pkgname}.install" <<EOF
post_install() {
  mkdir -p "$HOME/.local/share/actions-for-nautilus"
  [ -f "$HOME/.local/share/actions-for-nautilus/config.json" ] || \
  cp /usr/share/actions-for-nautilus-configurator/sample-config.json "$HOME/.local/share/actions-for-nautilus/config.json" && \
  chown -R $USER:$USER "$HOME/.local/share/actions-for-nautilus"
  echo "The installation has been successfully completed!"
  echo "To apply the changes, please restart Nautilus by running the following command in the terminal: nautilus -q"
}
post_upgrade() {
  post_install
}
post_remove() {
  [ ! -f "$HOME/.local/share/actions-for-nautilus/config.json" ] || rm -rf "$HOME/.local/share/actions-for-nautilus"
}
EOF
